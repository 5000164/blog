<!DOCTYPE html>
<html lang="ja">
<head>
    
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-51024599-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>HTMLとCSSとJavaScriptで空白と改行を削除するWebアプリを作ったので詳細説明します | 5000164 is here</title>
    <meta name="description" content="概要 半角スペース、全角スペース、タブ、改行を削除できます。 機能 改行削除 改行を削除して出力領域に書き出し。 ショートカットキーはCtrl &#43; Enter。 書き出したらテキストは全選択の状態なのでそのままコピー可。 空白削除 半角スペース、全角スペース、タブを削除して編集領域に上書き。 ショートカットキーはShift &#43; Enter。 空白の削除前に戻したい場合はCtrl &#43; Alt &#43; Z。 空白改行削除 半角スペース、全角スペース、タブ、改行を削除して出力領域に書き出し。 ショートカットキーはCtrl &#43; Shift &#43; Enter。 補助機能 TabキーでTab文字の挿入。 Shift &#43; Tabで行頭のTab文字を削除。 範囲を選択して削除した場合は選択範囲に対して処理の実行。 範囲を選択してTab、Shift &#43; Tabを押した場合には選択行に対して実行。 実装解説 それではHTMLとCSSとJavaScriptについて各部分の詳細を説明します。 実装解説：HTML">
    <link href="https://blog.5000164.jp/2013/11/29/space-delete/" rel="canonical">
    <meta property="og:type" content="article">
    <meta property="og:title" content="HTMLとCSSとJavaScriptで空白と改行を削除するWebアプリを作ったので詳細説明します | 5000164 is here">
    <meta property="og:description" content="概要 半角スペース、全角スペース、タブ、改行を削除できます。 機能 改行削除 改行を削除して出力領域に書き出し。 ショートカットキーはCtrl &#43; Enter。 書き出したらテキストは全選択の状態なのでそのままコピー可。 空白削除 半角スペース、全角スペース、タブを削除して編集領域に上書き。 ショートカットキーはShift &#43; Enter。 空白の削除前に戻したい場合はCtrl &#43; Alt &#43; Z。 空白改行削除 半角スペース、全角スペース、タブ、改行を削除して出力領域に書き出し。 ショートカットキーはCtrl &#43; Shift &#43; Enter。 補助機能 TabキーでTab文字の挿入。 Shift &#43; Tabで行頭のTab文字を削除。 範囲を選択して削除した場合は選択範囲に対して処理の実行。 範囲を選択してTab、Shift &#43; Tabを押した場合には選択行に対して実行。 実装解説 それではHTMLとCSSとJavaScriptについて各部分の詳細を説明します。 実装解説：HTML">
    <meta property="og:url" content="https://blog.5000164.jp/2013/11/29/space-delete/">
    <meta property="og:image" content="https://blog.5000164.jp/icon.png">
    <meta property="og:site_name" content="5000164 is here">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="HTMLとCSSとJavaScriptで空白と改行を削除するWebアプリを作ったので詳細説明します | 5000164 is here">
    <meta name="twitter:description" content="概要 半角スペース、全角スペース、タブ、改行を削除できます。 機能 改行削除 改行を削除して出力領域に書き出し。 ショートカットキーはCtrl &#43; Enter。 書き出したらテキストは全選択の状態なのでそのままコピー可。 空白削除 半角スペース、全角スペース、タブを削除して編集領域に上書き。 ショートカットキーはShift &#43; Enter。 空白の削除前に戻したい場合はCtrl &#43; Alt &#43; Z。 空白改行削除 半角スペース、全角スペース、タブ、改行を削除して出力領域に書き出し。 ショートカットキーはCtrl &#43; Shift &#43; Enter。 補助機能 TabキーでTab文字の挿入。 Shift &#43; Tabで行頭のTab文字を削除。 範囲を選択して削除した場合は選択範囲に対して処理の実行。 範囲を選択してTab、Shift &#43; Tabを押した場合には選択行に対して実行。 実装解説 それではHTMLとCSSとJavaScriptについて各部分の詳細を説明します。 実装解説：HTML">
    <meta name="twitter:url" content="https://blog.5000164.jp/2013/11/29/space-delete/">
    <meta name="twitter:image" content="https://blog.5000164.jp/icon.png">
    <meta name="twitter:site" content="@5000164">
    <meta name="twitter:creator" content="@5000164">
    <style type="text/css">html{width:100%;height:100%;margin:0;font-size:62.5%;font-family:-apple-system,BlinkMacSystemFont,"Helvetica Neue","ヒラギノ角ゴ ProN W3","Hiragino Kaku Gothic ProN",sans-serif;font-kerning:normal;font-feature-settings:"palt";letter-spacing:.02rem;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}body{width:100%;height:100%;margin:0;font-size:1.8rem;line-height:1.73;color:#454654;background-color:#fff}@media(max-width:640px){body{line-height:1.9}}header{height:15vw}@media(max-width:640px){header{height:50vw}}header>a{display:block;margin:-2.5vw 0 0 -3vw;font-size:24vw;line-height:1;text-align-last:justify;letter-spacing:-5vw;transform-origin:top center;transform:scaleY(0.5);color:#818398;text-decoration:none;white-space:nowrap}@media(max-width:640px){header>a{margin:-10.5vw 0 0 -3vw;transform:scaleY(2)}}header>a:visited{color:#818398}header>a::before,header>a::after{content:"";display:inline-block;position:absolute;top:21vw;width:0;height:.5vw;background:#c3ffde;transition:.2s ease-out}@media(max-width:640px){header>a::before,header>a::after{height:.4vw}}header>a::before{left:50%}header>a::after{right:50%}header>a:hover::before,header>a:hover::after{width:50%}footer{width:600px;margin:80px auto}footer .writer{text-align:right;letter-spacing:-0.2rem}footer .about{margin-top:200px}footer .year{margin-top:80px}@media(max-width:640px){footer{width:95%}}a{color:#454654}a:visited{color:#73758c}.articles{width:600px;list-style:none;margin:0 auto 20px;padding:0}@media(max-width:640px){.articles{width:95%}}.articles>li{margin:60px 0}.articles>li>a{display:grid;grid-template-columns:110px 1fr;grid-gap:2vw}.articles>li>a>div:first-child{text-align:right;white-space:nowrap}.articles>li>a>div:last-child{white-space:pre-wrap;word-break:break-all;word-wrap:break-word}.title{margin:40px 0}h1{width:600px;margin:0 auto;font-size:3rem;font-weight:bold}@media(max-width:640px){h1{width:95%}}.date{width:600px;margin:0 auto;text-align:right}@media(max-width:640px){.date{width:95%}}.content{margin:40px 0}.content p{width:600px;margin:40px auto}@media(max-width:640px){.content p{width:95%}}.content p:first-child{margin-top:0}.content p:last-child{margin-bottom:0}.content h2{width:600px;margin:120px auto 20px;font-size:2.4rem;font-weight:bold}@media(max-width:640px){.content h2{width:95%}}.content h2:first-child{margin-top:0}.content h2+p{margin-top:0}.content h2+h2{margin-top:0}.content h4{width:600px;margin:10px auto 10px;font-size:1.8rem;font-weight:normal;text-align:center}@media(max-width:640px){.content h4{width:95%}}.content ul,.content ol{width:580px;margin:auto;padding-left:20px}@media(max-width:640px){.content ul,.content ol{width:90%;padding-left:5%}}.content figure{width:600px;margin:auto}@media(max-width:640px){.content figure{width:95%}}.content img{display:block;max-width:600px;margin:0 auto}@media(max-width:640px){.content img{max-width:95%}}.content blockquote{width:600px;margin:20px auto}@media(max-width:640px){.content blockquote{width:95%}}.content blockquote>p{position:relative;width:580px;padding-left:20px}@media(max-width:640px){.content blockquote>p{width:96%;padding-left:4%}}.content blockquote>p::before{content:"";display:block;position:absolute;top:0;left:0;width:4px;height:100%;background:#e3e4e6;border-radius:8px}.content .highlight{margin:40px 0;background-color:#272822}.content .highlight>div{max-width:100%;margin:0 auto}.content .highlight table{display:flex !important;justify-content:center;align-items:center}.content .highlight tbody{min-width:600px;max-width:98%}@media(max-width:640px){.content .highlight tbody{min-width:95%;max-width:95%}}</style>
    <link href="/favicon.ico" rel="icon">
    <meta name="generator" content="Hugo 0.44" />
</head>
<body>
<header>
    <a href="https://blog.5000164.jp/">5000164 is here</a>
</header>

<article>
    <div class="title">
        <div class="date">2013.11.29</div>
        <h1>HTMLとCSSとJavaScriptで空白と改行を削除するWebアプリを作ったので詳細説明します</h1>
    </div>
    <div class="content">
        


<figure>
    
        <img src="/images/2013/11/20131129_space_delete.png" />
    
    
</figure>


<h2 id="概要">概要</h2>

<p>半角スペース、全角スペース、タブ、改行を削除できます。</p>

<h2 id="機能">機能</h2>

<h2 id="改行削除">改行削除</h2>

<p>改行を削除して出力領域に書き出し。<br />
ショートカットキーはCtrl + Enter。<br />
書き出したらテキストは全選択の状態なのでそのままコピー可。</p>

<h2 id="空白削除">空白削除</h2>

<p>半角スペース、全角スペース、タブを削除して編集領域に上書き。<br />
ショートカットキーはShift + Enter。<br />
空白の削除前に戻したい場合はCtrl + Alt + Z。</p>

<h2 id="空白改行削除">空白改行削除</h2>

<p>半角スペース、全角スペース、タブ、改行を削除して出力領域に書き出し。<br />
ショートカットキーはCtrl + Shift + Enter。</p>

<h2 id="補助機能">補助機能</h2>

<p>TabキーでTab文字の挿入。<br />
Shift + Tabで行頭のTab文字を削除。<br />
範囲を選択して削除した場合は選択範囲に対して処理の実行。<br />
範囲を選択してTab、Shift + Tabを押した場合には選択行に対して実行。</p>

<h2 id="実装解説">実装解説</h2>

<p>それではHTMLとCSSとJavaScriptについて各部分の詳細を説明します。</p>

<h2 id="実装解説-html">実装解説：HTML</h2>

<p>メインの部分はこんな感じです。</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#f92672">header</span>&gt;
  &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;button_wrapper&#34;</span>&gt;
    &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;button&#34;</span>&gt;&lt;<span style="color:#f92672">label</span>&gt;&lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;checkbox&#34;</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;space_delete_flg&#34;</span>&gt;&lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;space_button&#34;</span>&gt;空白&lt;/<span style="color:#f92672">div</span>&gt;&lt;/<span style="color:#f92672">label</span>&gt;&lt;/<span style="color:#f92672">div</span>&gt;
    &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;button&#34;</span>&gt;&lt;<span style="color:#f92672">label</span>&gt;&lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;checkbox&#34;</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;newline_delete_flg&#34;</span> <span style="color:#a6e22e">checked</span>&gt;&lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;newline_button&#34;</span>&gt;改行&lt;/<span style="color:#f92672">div</span>&gt;&lt;/<span style="color:#f92672">label</span>&gt;&lt;/<span style="color:#f92672">div</span>&gt;
    &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;delete_button&#34;</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;button&#34;</span>&gt;削除&lt;/<span style="color:#f92672">div</span>&gt;
  &lt;/<span style="color:#f92672">div</span>&gt;
  &lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;http://5000164.jp/2013-11-space_delete/&#34;</span> <span style="color:#a6e22e">target</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;_blank&#34;</span>&gt;&lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;info&#34;</span>&gt;i&lt;/<span style="color:#f92672">div</span>&gt;&lt;/<span style="color:#f92672">a</span>&gt;
&lt;/<span style="color:#f92672">header</span>&gt;
&lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;input_wrapper&#34;</span>&gt;
  &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;input_area&#34;</span>&gt;
    &lt;<span style="color:#f92672">textarea</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;input&#34;</span>&gt;&lt;/<span style="color:#f92672">textarea</span>&gt;
    &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;input_background&#34;</span>&gt;&lt;/<span style="color:#f92672">div</span>&gt;
  &lt;/<span style="color:#f92672">div</span>&gt;
&lt;/<span style="color:#f92672">div</span>&gt;
&lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;output_area&#34;</span>&gt;
  &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text&#34;</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;result&#34;</span> <span style="color:#a6e22e">readonly</span>&gt;&lt;/<span style="color:#f92672">input</span>&gt;
&lt;/<span style="color:#f92672">div</span>&gt;</code></pre></td></tr></table>
</div>
</div>
<p>タグ構造は非常にシンプルです。<br />
今回はtextareaに入力した内容に合わせて背景色を変えるという処理を行っているので、textareaとdivタグを重ねています。<br />
ただ、contenteditableを使えば1つのタグだけでいけるのかもしれません。<br />
textareaとdivタグを重ねる手法だと、常に内容を同期させる必要があるので処理が重くなる可能性があります。<br />
ちょっとした入力内容から大丈夫かも知れませんが、次に同じようなことをしたくなったらcontenteditableでやります。</p>

<h2 id="実装解説-css">実装解説：CSS</h2>

<p>今回のCSSでは、編集領域をウィンドウサイズに合わせる、空白などの見えない文字を可視化する、ボタンを押した時にテキストが動く、というところがメインです。</p>

<h2 id="編集領域をウィンドウサイズに合わせる">編集領域をウィンドウサイズに合わせる</h2>

<p>まずは編集領域をウィンドウサイズに合わせる部分から。<br />
重要になるのはこのへんです。</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-css" data-lang="css"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-css" data-lang="css"><span style="color:#f92672">html</span><span style="color:#f92672">,</span> <span style="color:#f92672">body</span> {
  <span style="color:#66d9ef">width</span>: <span style="color:#ae81ff">100</span><span style="color:#66d9ef">%</span>;
  <span style="color:#66d9ef">height</span>: <span style="color:#ae81ff">100</span><span style="color:#66d9ef">%</span>;
  <span style="color:#66d9ef">margin</span>: <span style="color:#ae81ff">0</span>;
  <span style="color:#66d9ef">padding</span>: <span style="color:#ae81ff">0</span>;
  <span style="color:#66d9ef">background</span>: hsl(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span><span style="color:#66d9ef">%</span>, <span style="color:#ae81ff">15</span><span style="color:#66d9ef">%</span>);
}
#input_wrapper {
  <span style="color:#66d9ef">box-sizing</span>: <span style="color:#66d9ef">border-box</span>;
  <span style="color:#66d9ef">width</span>: <span style="color:#ae81ff">100</span><span style="color:#66d9ef">%</span>;
  <span style="color:#66d9ef">min-width</span>: <span style="color:#ae81ff">640</span><span style="color:#66d9ef">px</span>;
  <span style="color:#66d9ef">height</span>: <span style="color:#ae81ff">100</span><span style="color:#66d9ef">%</span>;
  <span style="color:#66d9ef">margin</span>: <span style="color:#ae81ff">0</span>;
  <span style="color:#66d9ef">padding</span>: <span style="color:#ae81ff">30</span><span style="color:#66d9ef">px</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">20</span><span style="color:#66d9ef">px</span>;
  <span style="color:#66d9ef">background</span>: hsl(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span><span style="color:#66d9ef">%</span>, <span style="color:#ae81ff">15</span><span style="color:#66d9ef">%</span>);
}</code></pre></td></tr></table>
</div>
</div>
<p>あんまり見なれないheight: 100%;が重要になります。<br />
私は初めて使った気がします。<br />
height: 100%;を使うためには、htmlとbodyにheight: 100%;を指定する必要があります。<br />
これ重要です。<br />
あとはコンテンツ部分にもheight: 100%;を指定して、paddingで上下の余白を調整してあげれば、コンテンツの高さを自動でウィンドウサイズに合わせることができます。</p>

<h2 id="空白などの見えない文字を可視化する">空白などの見えない文字を可視化する</h2>

<p>まずはtextareaとdivタグがずれないようにちゃんとスタイルを合わせます。</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-css" data-lang="css"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">53
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-css" data-lang="css">#input_area {
  <span style="color:#66d9ef">position</span>: <span style="color:#66d9ef">relative</span>;
  <span style="color:#66d9ef">box-sizing</span>: <span style="color:#66d9ef">border-box</span>;
  <span style="color:#66d9ef">width</span>: <span style="color:#ae81ff">100</span><span style="color:#66d9ef">%</span>;
  <span style="color:#66d9ef">min-width</span>: <span style="color:#ae81ff">640</span><span style="color:#66d9ef">px</span>;
  <span style="color:#66d9ef">height</span>: <span style="color:#ae81ff">100</span><span style="color:#66d9ef">%</span>;
  <span style="color:#66d9ef">margin</span>: <span style="color:#ae81ff">0</span>;
  <span style="color:#66d9ef">padding</span>: <span style="color:#ae81ff">0</span>;
}
#input {
  <span style="color:#66d9ef">z-index</span>: <span style="color:#ae81ff">2</span>;
  <span style="color:#66d9ef">display</span>: <span style="color:#66d9ef">block</span>;
  <span style="color:#66d9ef">position</span>: <span style="color:#66d9ef">absolute</span>;
  <span style="color:#66d9ef">top</span>: <span style="color:#ae81ff">0</span>;
  <span style="color:#66d9ef">left</span>: <span style="color:#ae81ff">0</span>;
  <span style="color:#66d9ef">box-sizing</span>: <span style="color:#66d9ef">border-box</span>;
  <span style="color:#66d9ef">width</span>: <span style="color:#ae81ff">100</span><span style="color:#66d9ef">%</span>;
  <span style="color:#66d9ef">min-width</span>: <span style="color:#ae81ff">610</span><span style="color:#66d9ef">px</span>;
  <span style="color:#66d9ef">height</span>: <span style="color:#ae81ff">100</span><span style="color:#66d9ef">%</span>;
  <span style="color:#66d9ef">margin</span>: <span style="color:#ae81ff">0</span>;
  <span style="color:#66d9ef">padding</span>: <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">15</span><span style="color:#66d9ef">px</span>;
  <span style="color:#66d9ef">resize</span>: <span style="color:#66d9ef">none</span>;
  <span style="color:#66d9ef">word-break</span>: break-all;
  <span style="color:#66d9ef">word-wrap</span>: <span style="color:#66d9ef">break-word</span>;
  <span style="color:#66d9ef">white-space</span>: <span style="color:#66d9ef">pre</span><span style="color:#f92672">-</span><span style="color:#66d9ef">wrap</span>;
  <span style="color:#66d9ef">font-family</span>: <span style="color:#66d9ef">sans-serif</span>;
  <span style="color:#66d9ef">font-size</span>: <span style="color:#ae81ff">18</span><span style="color:#66d9ef">px</span>;
  <span style="color:#66d9ef">line-height</span>: <span style="color:#ae81ff">30</span><span style="color:#66d9ef">px</span>;
  <span style="color:#66d9ef">color</span>: hsl(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span><span style="color:#66d9ef">%</span>, <span style="color:#ae81ff">85</span><span style="color:#66d9ef">%</span>);
  <span style="color:#66d9ef">background</span>: <span style="color:#66d9ef">transparent</span>;
  <span style="color:#66d9ef">border</span>: <span style="color:#66d9ef">none</span>;
  <span style="color:#66d9ef">outline</span>: <span style="color:#66d9ef">none</span>;
}
#input_background {
  <span style="color:#66d9ef">z-index</span>: <span style="color:#ae81ff">1</span>;
  <span style="color:#66d9ef">position</span>: <span style="color:#66d9ef">absolute</span>;
  <span style="color:#66d9ef">top</span>: <span style="color:#ae81ff">0</span>;
  <span style="color:#66d9ef">left</span>: <span style="color:#ae81ff">0</span>;
  <span style="color:#66d9ef">overflow-y</span>: <span style="color:#66d9ef">auto</span>;
  <span style="color:#66d9ef">box-sizing</span>: <span style="color:#66d9ef">border-box</span>;
  <span style="color:#66d9ef">width</span>: <span style="color:#ae81ff">100</span><span style="color:#66d9ef">%</span>;
  <span style="color:#66d9ef">min-width</span>: <span style="color:#ae81ff">610</span><span style="color:#66d9ef">px</span>;
  <span style="color:#66d9ef">height</span>: <span style="color:#ae81ff">100</span><span style="color:#66d9ef">%</span>;
  <span style="color:#66d9ef">margin</span>: <span style="color:#ae81ff">0</span>;
  <span style="color:#66d9ef">padding</span>: <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">15</span><span style="color:#66d9ef">px</span>;
  <span style="color:#66d9ef">word-break</span>: break-all;
  <span style="color:#66d9ef">word-wrap</span>: <span style="color:#66d9ef">break-word</span>;
  <span style="color:#66d9ef">white-space</span>: <span style="color:#66d9ef">pre</span><span style="color:#f92672">-</span><span style="color:#66d9ef">wrap</span>;
  <span style="color:#66d9ef">font-family</span>: <span style="color:#66d9ef">sans-serif</span>;
  <span style="color:#66d9ef">font-size</span>: <span style="color:#ae81ff">18</span><span style="color:#66d9ef">px</span>;
  <span style="color:#66d9ef">line-height</span>: <span style="color:#ae81ff">30</span><span style="color:#66d9ef">px</span>;
  <span style="color:#66d9ef">color</span>: <span style="color:#66d9ef">transparent</span>;
}</code></pre></td></tr></table>
</div>
</div>
<p>ここではまず、親要素にposition: relative;を指定して、子要素にposition: absolute;のtop: 0;left: 0;で位置を合わせ、文字のスタイルなどを一致させます。<br />
そしてtextareaをbackground: transparent;とすることで後ろのdivタグが見えるようになります。<br />
divタグにはcolor: transparent;と指定してテキストが見えないようにします。<br />
これで表示する位置を合わせたら、次は実際に表示させます。</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-css" data-lang="css"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">55
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">56
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">57
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">58
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">59
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">60
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">61
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">62
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">63
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">64
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">65
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-css" data-lang="css">#input_background <span style="color:#f92672">&gt;</span> <span style="color:#f92672">pre</span> {
  <span style="color:#66d9ef">display</span>: <span style="color:#66d9ef">inline</span>;
  <span style="color:#66d9ef">margin</span>: <span style="color:#ae81ff">0</span>;
  <span style="color:#66d9ef">white-space</span>: <span style="color:#66d9ef">pre</span><span style="color:#f92672">-</span><span style="color:#66d9ef">wrap</span>;
  <span style="color:#66d9ef">font-family</span>: <span style="color:#66d9ef">sans-serif</span>;
  <span style="color:#66d9ef">font-size</span>: <span style="color:#ae81ff">18</span><span style="color:#66d9ef">px</span>;
  <span style="color:#66d9ef">line-height</span>: <span style="color:#ae81ff">30</span><span style="color:#66d9ef">px</span>;
}
#input_background <span style="color:#f92672">&gt;</span> <span style="color:#f92672">pre</span>:<span style="color:#a6e22e">after</span> {
  <span style="color:#66d9ef">content</span>: <span style="color:#e6db74">&#34;&#34;</span>;
  <span style="color:#66d9ef">display</span>: <span style="color:#66d9ef">block</span>;
  <span style="color:#66d9ef">position</span>: <span style="color:#66d9ef">absolute</span>;
  <span style="color:#66d9ef">top</span>: <span style="color:#ae81ff">0</span>;
  <span style="color:#66d9ef">left</span>: <span style="color:#ae81ff">0</span>;
  <span style="color:#66d9ef">width</span>: <span style="color:#ae81ff">100</span><span style="color:#66d9ef">%</span>;
  <span style="color:#66d9ef">font-family</span>: <span style="color:#66d9ef">sans-serif</span>;
  <span style="color:#66d9ef">font-size</span>: <span style="color:#ae81ff">10</span><span style="color:#66d9ef">px</span>;
  <span style="color:#66d9ef">line-height</span>: <span style="color:#ae81ff">30</span><span style="color:#66d9ef">px</span>;
  <span style="color:#66d9ef">color</span>: hsl(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span><span style="color:#66d9ef">%</span>, <span style="color:#ae81ff">40</span><span style="color:#66d9ef">%</span>);
  <span style="color:#66d9ef">text-align</span>: <span style="color:#66d9ef">center</span>;
}
#input_background <span style="color:#f92672">&gt;</span> <span style="color:#f92672">pre</span>.<span style="color:#a6e22e">space</span> {
  <span style="color:#66d9ef">position</span>: <span style="color:#66d9ef">relative</span>;
  <span style="color:#66d9ef">background</span>: hsl(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span><span style="color:#66d9ef">%</span>, <span style="color:#ae81ff">20</span><span style="color:#66d9ef">%</span>);
}
#input_background <span style="color:#f92672">&gt;</span> <span style="color:#f92672">pre</span>.<span style="color:#a6e22e">space</span>:<span style="color:#a6e22e">after</span> {
  <span style="color:#66d9ef">content</span>: <span style="color:#e6db74">&#34;･&#34;</span>;
}
#input_background <span style="color:#f92672">&gt;</span> <span style="color:#f92672">pre</span>.<span style="color:#a6e22e">em_space</span> {
  <span style="color:#66d9ef">position</span>: <span style="color:#66d9ef">relative</span>;
  <span style="color:#66d9ef">background</span>: hsl(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span><span style="color:#66d9ef">%</span>, <span style="color:#ae81ff">20</span><span style="color:#66d9ef">%</span>);
}
#input_background <span style="color:#f92672">&gt;</span> <span style="color:#f92672">pre</span>.<span style="color:#a6e22e">em_space</span>:<span style="color:#a6e22e">after</span> {
  <span style="color:#66d9ef">content</span>: <span style="color:#e6db74">&#34;□&#34;</span>;
  <span style="color:#66d9ef">font-size</span>: <span style="color:#ae81ff">18</span><span style="color:#66d9ef">px</span>;
}
#input_background <span style="color:#f92672">&gt;</span> <span style="color:#f92672">pre</span>.<span style="color:#a6e22e">tab</span> {
  <span style="color:#66d9ef">position</span>: <span style="color:#66d9ef">relative</span>;
  <span style="color:#66d9ef">background</span>: hsl(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span><span style="color:#66d9ef">%</span>, <span style="color:#ae81ff">20</span><span style="color:#66d9ef">%</span>);
}
#input_background <span style="color:#f92672">&gt;</span> <span style="color:#f92672">pre</span>.<span style="color:#a6e22e">tab</span>:<span style="color:#a6e22e">after</span> {
  <span style="color:#66d9ef">content</span>: <span style="color:#e6db74">&#34;→&#34;</span>;
  <span style="color:#66d9ef">text-align</span>: <span style="color:#66d9ef">left</span>;
}
#input_background <span style="color:#f92672">&gt;</span> <span style="color:#f92672">pre</span>.<span style="color:#a6e22e">crlf</span> {
  <span style="color:#66d9ef">position</span>: <span style="color:#66d9ef">relative</span>;
  <span style="color:#66d9ef">background</span>: hsl(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span><span style="color:#66d9ef">%</span>, <span style="color:#ae81ff">20</span><span style="color:#66d9ef">%</span>);
}
#input_background <span style="color:#f92672">&gt;</span> <span style="color:#f92672">pre</span>.<span style="color:#a6e22e">crlf</span>:<span style="color:#a6e22e">after</span> {
  <span style="color:#66d9ef">content</span>: <span style="color:#e6db74">&#34;←↓&#34;</span>;
}
#input_background <span style="color:#f92672">&gt;</span> <span style="color:#f92672">pre</span>.<span style="color:#a6e22e">cr</span> {
  <span style="color:#66d9ef">position</span>: <span style="color:#66d9ef">relative</span>;
  <span style="color:#66d9ef">background</span>: hsl(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span><span style="color:#66d9ef">%</span>, <span style="color:#ae81ff">20</span><span style="color:#66d9ef">%</span>);
}
#input_background <span style="color:#f92672">&gt;</span> <span style="color:#f92672">pre</span>.<span style="color:#a6e22e">cr</span>:<span style="color:#a6e22e">after</span> {
  <span style="color:#66d9ef">content</span>: <span style="color:#e6db74">&#34;←&#34;</span>;
}
#input_background <span style="color:#f92672">&gt;</span> <span style="color:#f92672">pre</span>.<span style="color:#a6e22e">lf</span> {
  <span style="color:#66d9ef">position</span>: <span style="color:#66d9ef">relative</span>;
  <span style="color:#66d9ef">background</span>: hsl(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span><span style="color:#66d9ef">%</span>, <span style="color:#ae81ff">20</span><span style="color:#66d9ef">%</span>);
}
#input_background <span style="color:#f92672">&gt;</span> <span style="color:#f92672">pre</span>.<span style="color:#a6e22e">lf</span>:<span style="color:#a6e22e">after</span> {
  <span style="color:#66d9ef">content</span>: <span style="color:#e6db74">&#34;↓&#34;</span>;
}</code></pre></td></tr></table>
</div>
</div>
<p>ここではJavaScriptで該当の文字をpreタグで囲い、該当の文字ごとにクラス名が付けられる、という前提でのスタイルです。<br />
例えば、pre.spaceがあったら、背景を変えて「･」を表示させるようにしています。<br />
実際にpreタグの中に「･」を入れてしまうとtextareaとdivタグで内容が一致しなくなってしまうので、擬似要素を使って表示しています。</p>

<h2 id="ボタンを押した時にテキストが動く">ボタンを押した時にテキストが動く</h2>

<p>ここでは私がかねてから実装してみたかった、バウンスするようなアニメーションを適用しています。<br />
例として空白ボタンを見てみます。</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-css" data-lang="css"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-css" data-lang="css"><span style="color:#f92672">header</span> <span style="color:#f92672">input</span><span style="color:#f92672">[</span><span style="color:#f92672">type</span><span style="color:#f92672">=</span><span style="color:#f92672">checkbox</span><span style="color:#f92672">]</span>:<span style="color:#a6e22e">checked</span> <span style="color:#f92672">+</span> #space_button {
  <span style="color:#66d9ef">background</span>: hsl(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span><span style="color:#66d9ef">%</span>, <span style="color:#ae81ff">5</span><span style="color:#66d9ef">%</span>);
  <span style="color:#66d9ef">border</span>: <span style="color:#ae81ff">1</span><span style="color:#66d9ef">px</span> <span style="color:#66d9ef">solid</span> hsl(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span><span style="color:#66d9ef">%</span>, <span style="color:#ae81ff">4</span><span style="color:#66d9ef">%</span>);
  <span style="color:#66d9ef">box-shadow</span>: <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">1</span><span style="color:#66d9ef">px</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> hsl(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span><span style="color:#66d9ef">%</span>, <span style="color:#ae81ff">13</span><span style="color:#66d9ef">%</span>);
  <span style="color:#66d9ef">text-indent</span>: <span style="color:#ae81ff">-.1</span><span style="color:#66d9ef">em</span>;
  <span style="color:#66d9ef">letter-spacing</span>: <span style="color:#ae81ff">-.1</span><span style="color:#66d9ef">em</span>;
  <span style="color:#66d9ef">-webkit-</span><span style="color:#66d9ef">animation</span>: space_button <span style="color:#ae81ff">500</span><span style="color:#66d9ef">ms</span> <span style="color:#66d9ef">ease</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">normal</span>;
}</code></pre></td></tr></table>
</div>
</div>
<p>擬似要素が:checkedの時にだけアニメーションを指定することで、空白ボタンがチェックされたらアニメーションするようにしています。<br />
実際のアニメーションの動作はこうなっています。</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-css" data-lang="css"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">46
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-css" data-lang="css">@<span style="color:#66d9ef">-webkit-keyframes</span> <span style="color:#f92672">space_button</span> {
  <span style="color:#f92672">0</span><span style="color:#f92672">%</span> {
    <span style="color:#66d9ef">text-indent</span>: <span style="color:#ae81ff">1</span><span style="color:#66d9ef">em</span>;
    <span style="color:#66d9ef">letter-spacing</span>: <span style="color:#ae81ff">1</span><span style="color:#66d9ef">em</span>;
  }
  <span style="color:#f92672">10</span><span style="color:#f92672">%</span> {
    <span style="color:#66d9ef">text-indent</span>: <span style="color:#ae81ff">.9</span><span style="color:#66d9ef">em</span>;
    <span style="color:#66d9ef">letter-spacing</span>: <span style="color:#ae81ff">.9</span><span style="color:#66d9ef">em</span>;
  }
  <span style="color:#f92672">20</span><span style="color:#f92672">%</span> {
    <span style="color:#66d9ef">text-indent</span>: <span style="color:#ae81ff">.7</span><span style="color:#66d9ef">em</span>;
    <span style="color:#66d9ef">letter-spacing</span>: <span style="color:#ae81ff">.7</span><span style="color:#66d9ef">em</span>;
  }
  <span style="color:#f92672">30</span><span style="color:#f92672">%</span> {
    <span style="color:#66d9ef">text-indent</span>: <span style="color:#ae81ff">.4</span><span style="color:#66d9ef">em</span>;
    <span style="color:#66d9ef">letter-spacing</span>: <span style="color:#ae81ff">.4</span><span style="color:#66d9ef">em</span>;
  }
  <span style="color:#f92672">40</span><span style="color:#f92672">%</span> {
    <span style="color:#66d9ef">text-indent</span>: <span style="color:#ae81ff">-.1</span><span style="color:#66d9ef">em</span>;
    <span style="color:#66d9ef">letter-spacing</span>: <span style="color:#ae81ff">-.1</span><span style="color:#66d9ef">em</span>;
  }
  <span style="color:#f92672">50</span><span style="color:#f92672">%</span> {
    <span style="color:#66d9ef">text-indent</span>: <span style="color:#ae81ff">.3</span><span style="color:#66d9ef">em</span>;
    <span style="color:#66d9ef">letter-spacing</span>: <span style="color:#ae81ff">.3</span><span style="color:#66d9ef">em</span>;
  }
  <span style="color:#f92672">60</span><span style="color:#f92672">%</span> {
    <span style="color:#66d9ef">text-indent</span>: <span style="color:#ae81ff">-.1</span><span style="color:#66d9ef">em</span>;
    <span style="color:#66d9ef">letter-spacing</span>: <span style="color:#ae81ff">-.1</span><span style="color:#66d9ef">em</span>;
  }
  <span style="color:#f92672">70</span><span style="color:#f92672">%</span> {
    <span style="color:#66d9ef">text-indent</span>: <span style="color:#ae81ff">.1</span><span style="color:#66d9ef">em</span>;
    <span style="color:#66d9ef">letter-spacing</span>: <span style="color:#ae81ff">.1</span><span style="color:#66d9ef">em</span>;
  }
  <span style="color:#f92672">80</span><span style="color:#f92672">%</span> {
    <span style="color:#66d9ef">text-indent</span>: <span style="color:#ae81ff">-.1</span><span style="color:#66d9ef">em</span>;
    <span style="color:#66d9ef">letter-spacing</span>: <span style="color:#ae81ff">-.1</span><span style="color:#66d9ef">em</span>;
  }
  <span style="color:#f92672">90</span><span style="color:#f92672">%</span> {
    <span style="color:#66d9ef">text-indent</span>: <span style="color:#ae81ff">0</span><span style="color:#66d9ef">em</span>;
    <span style="color:#66d9ef">letter-spacing</span>: <span style="color:#ae81ff">0</span><span style="color:#66d9ef">em</span>;
  }
  <span style="color:#f92672">100</span><span style="color:#f92672">%</span> {
    <span style="color:#66d9ef">text-indent</span>: <span style="color:#ae81ff">-.1</span><span style="color:#66d9ef">em</span>;
    <span style="color:#66d9ef">letter-spacing</span>: <span style="color:#ae81ff">-.1</span><span style="color:#66d9ef">em</span>;
  }
}</code></pre></td></tr></table>
</div>
</div>
<p>このように、ここではtext-indentとletter-spacingを使うことで文字の間隔を変えています。<br />
あとは10%ごとに跳ね返ってるように見えるように間隔を調整すれば完了です。<br />
空白を消してるぞ！っというような動きができたので個人的には非常に満足しています。</p>

<h2 id="実装解説-javascript">実装解説：JavaScript</h2>

<p>JavaScriptの解説ですね。<br />
おおまかに分けると、入力内容の同期、空白や改行の削除処理、Tabの処理、となっています。<br />
また、今回はライブラリとしてjQueryを使用しています。</p>

<h2 id="入力内容の同期">入力内容の同期</h2>

<p>特定の文字に色をつけるために、textareaとdivの内容を同期します。<br />
その際に、特定の文字をマークアップしたり、入力内容のエスケープを行います。</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">50
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#75715e">// ～中略～
</span><span style="color:#75715e"></span><span style="color:#a6e22e">$</span>(<span style="color:#66d9ef">function</span>() {
  <span style="color:#75715e">// ～中略～
</span><span style="color:#75715e"></span>  <span style="color:#75715e">// 入力された値を常に監視する
</span><span style="color:#75715e"></span>  <span style="color:#a6e22e">$</span>(<span style="color:#e6db74">&#34;#input&#34;</span>).<span style="color:#a6e22e">bind</span>(<span style="color:#e6db74">&#39;keydown keyup keypress change focus click&#39;</span>, <span style="color:#66d9ef">function</span>() {
    <span style="color:#a6e22e">inputWatch</span>(<span style="color:#a6e22e">$</span>(<span style="color:#e6db74">&#34;#input&#34;</span>).<span style="color:#a6e22e">val</span>());
  });
  
  <span style="color:#75715e">// スクロールを同期する
</span><span style="color:#75715e"></span>  <span style="color:#a6e22e">$</span>(<span style="color:#e6db74">&#34;#input&#34;</span>).<span style="color:#a6e22e">bind</span>(<span style="color:#e6db74">&#39;keydown keyup keypress change scroll&#39;</span>, <span style="color:#66d9ef">function</span>() {
    <span style="color:#a6e22e">$</span>(<span style="color:#e6db74">&#34;#input_background&#34;</span>).<span style="color:#a6e22e">scrollTop</span>(<span style="color:#a6e22e">$</span>(<span style="color:#e6db74">&#34;#input&#34;</span>).<span style="color:#a6e22e">scrollTop</span>());
  });
  <span style="color:#75715e">// ～中略～
</span><span style="color:#75715e"></span>});



<span style="color:#75715e">// 入力内容を監視
</span><span style="color:#75715e"></span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">inputWatch</span>(<span style="color:#a6e22e">inputText</span>) {
  <span style="color:#a6e22e">inputText</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">escapeHtml</span>(<span style="color:#a6e22e">inputText</span>);
  
  <span style="color:#75715e">// 入力された文字列を可視化する
</span><span style="color:#75715e"></span>  <span style="color:#a6e22e">inputText</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">inputText</span>.<span style="color:#a6e22e">replace</span>(<span style="color:#e6db74">/ /g</span>, <span style="color:#e6db74">&#34;&lt;pre class=\&#34;space\&#34;&gt; &lt;/pre&gt;&#34;</span>); <span style="color:#75715e">// 半角スペース
</span><span style="color:#75715e"></span>  <span style="color:#a6e22e">inputText</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">inputText</span>.<span style="color:#a6e22e">replace</span>(<span style="color:#e6db74">/　/g</span>, <span style="color:#e6db74">&#34;&lt;pre class=\&#34;em_space\&#34;&gt;　&lt;/pre&gt;&#34;</span>); <span style="color:#75715e">// 全角スペース
</span><span style="color:#75715e"></span>  <span style="color:#a6e22e">inputText</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">inputText</span>.<span style="color:#a6e22e">replace</span>(<span style="color:#e6db74">/\t/g</span>, <span style="color:#e6db74">&#34;&lt;pre class=\&#34;tab\&#34;&gt;   &lt;/pre&gt;&#34;</span>); <span style="color:#75715e">// タブ
</span><span style="color:#75715e"></span>  <span style="color:#a6e22e">inputText</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">inputText</span>.<span style="color:#a6e22e">replace</span>(<span style="color:#e6db74">/\r\n/g</span>, <span style="color:#e6db74">&#34;&lt;pre class=\&#34;crlf\&#34;&gt;&lt;/pre&gt;&lt;br&gt;&#34;</span>); <span style="color:#75715e">// CRLF
</span><span style="color:#75715e"></span>  <span style="color:#a6e22e">inputText</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">inputText</span>.<span style="color:#a6e22e">replace</span>(<span style="color:#e6db74">/\r/g</span>, <span style="color:#e6db74">&#34;&lt;pre class=\&#34;cr\&#34;&gt;&lt;/pre&gt;&lt;br&gt;&#34;</span>); <span style="color:#75715e">// CR
</span><span style="color:#75715e"></span>  <span style="color:#a6e22e">inputText</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">inputText</span>.<span style="color:#a6e22e">replace</span>(<span style="color:#e6db74">/\n/g</span>, <span style="color:#e6db74">&#34;&lt;pre class=\&#34;lf\&#34;&gt;&lt;/pre&gt;&lt;br&gt;&#34;</span>); <span style="color:#75715e">// LF
</span><span style="color:#75715e"></span>    
  <span style="color:#75715e">// div要素の最後が&lt;br&gt;だとheightに反映されないようなので空白を最後に追加する
</span><span style="color:#75715e"></span>  <span style="color:#a6e22e">inputText</span> <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;　&#34;</span>;
  
  <span style="color:#75715e">// 入力内容と背景用の内容を同期させる
</span><span style="color:#75715e"></span>  <span style="color:#a6e22e">$</span>(<span style="color:#e6db74">&#34;#input_background&#34;</span>).<span style="color:#a6e22e">html</span>(<span style="color:#a6e22e">inputText</span>);
}



<span style="color:#75715e">// HTML用に文字列をエスケープする
</span><span style="color:#75715e"></span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">escapeHtml</span>(<span style="color:#a6e22e">string</span>) {
  <span style="color:#75715e">// エスケープ対象は「&amp;」「&lt;」「&gt;」「&#34;」「&#39;」
</span><span style="color:#75715e"></span>  <span style="color:#a6e22e">string</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">string</span>.<span style="color:#a6e22e">replace</span>(<span style="color:#e6db74">/&amp;/g</span>, <span style="color:#e6db74">&#34;&amp;amp;&#34;</span>);
  <span style="color:#a6e22e">string</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">string</span>.<span style="color:#a6e22e">replace</span>(<span style="color:#e6db74">/&lt;/g</span>, <span style="color:#e6db74">&#34;&amp;lt;&#34;</span>);
  <span style="color:#a6e22e">string</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">string</span>.<span style="color:#a6e22e">replace</span>(<span style="color:#e6db74">/&gt;/g</span>, <span style="color:#e6db74">&#34;&amp;gt;&#34;</span>);
  <span style="color:#a6e22e">string</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">string</span>.<span style="color:#a6e22e">replace</span>(<span style="color:#e6db74">/\&#34;/g</span>, <span style="color:#e6db74">&#34;&amp;quot;&#34;</span>);
  <span style="color:#a6e22e">string</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">string</span>.<span style="color:#a6e22e">replace</span>(<span style="color:#e6db74">/\&#39;/g</span>, <span style="color:#e6db74">&#34;&amp;#39;&#34;</span>);
  
  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">string</span>;
}
</code></pre></td></tr></table>
</div>
</div>
<p>内容を同期する時は、内容が変更しそうなイベントをすべてバインドして、同期処理を走らせます。</p>

<h2 id="空白や改行の削除処理">空白や改行の削除処理</h2>

<p>空白や改行は正規表現で削除しています。</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">55
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">56
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">57
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">58
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">59
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">60
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">61
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">62
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">63
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">64
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">65
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">66
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">67
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">68
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">69
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">70
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">71
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">72
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">73
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#75715e">// 改行削除
</span><span style="color:#75715e"></span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">newlineDelete</span>() {
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">posStart</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">$</span>(<span style="color:#e6db74">&#34;#input&#34;</span>).<span style="color:#a6e22e">get</span>(<span style="color:#ae81ff">0</span>).<span style="color:#a6e22e">selectionStart</span>;
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">posEnd</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">$</span>(<span style="color:#e6db74">&#34;#input&#34;</span>).<span style="color:#a6e22e">get</span>(<span style="color:#ae81ff">0</span>).<span style="color:#a6e22e">selectionEnd</span>;
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">inputStr</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">$</span>(<span style="color:#e6db74">&#34;#input&#34;</span>).<span style="color:#a6e22e">val</span>();
  
  <span style="color:#75715e">// 範囲選択をしていない場合
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">posStart</span> <span style="color:#f92672">===</span> <span style="color:#a6e22e">posEnd</span>) {
    <span style="color:#75715e">// 改行をすべて削除
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">$</span>(<span style="color:#e6db74">&#34;#result&#34;</span>).<span style="color:#a6e22e">val</span>(<span style="color:#a6e22e">inputStr</span>.<span style="color:#a6e22e">replace</span>(<span style="color:#e6db74">/[\n\r]/g</span>, <span style="color:#e6db74">&#34;&#34;</span>));
  }
  <span style="color:#75715e">// 範囲選択をしている場合
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">else</span> {
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">selStr</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">inputStr</span>.<span style="color:#a6e22e">substring</span>(<span style="color:#a6e22e">posStart</span>, <span style="color:#a6e22e">posEnd</span>);
    <span style="color:#75715e">// 改行をすべて削除
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">$</span>(<span style="color:#e6db74">&#34;#result&#34;</span>).<span style="color:#a6e22e">val</span>(<span style="color:#a6e22e">selStr</span>.<span style="color:#a6e22e">replace</span>(<span style="color:#e6db74">/[\n\r]/g</span>, <span style="color:#e6db74">&#34;&#34;</span>));
  }
  
  <span style="color:#a6e22e">$</span>(<span style="color:#e6db74">&#34;#result&#34;</span>).<span style="color:#a6e22e">focus</span>();
}



<span style="color:#75715e">// 空白削除
</span><span style="color:#75715e"></span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">spaceDelete</span>() {
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">posStart</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">$</span>(<span style="color:#e6db74">&#34;#input&#34;</span>).<span style="color:#a6e22e">get</span>(<span style="color:#ae81ff">0</span>).<span style="color:#a6e22e">selectionStart</span>;
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">posEnd</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">$</span>(<span style="color:#e6db74">&#34;#input&#34;</span>).<span style="color:#a6e22e">get</span>(<span style="color:#ae81ff">0</span>).<span style="color:#a6e22e">selectionEnd</span>;
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">inputStr</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">$</span>(<span style="color:#e6db74">&#34;#input&#34;</span>).<span style="color:#a6e22e">val</span>();
  <span style="color:#75715e">// 内容をバックアップ
</span><span style="color:#75715e"></span>  <span style="color:#a6e22e">backupStr</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">$</span>(<span style="color:#e6db74">&#34;#input&#34;</span>).<span style="color:#a6e22e">val</span>();
  <span style="color:#a6e22e">backupPos</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">posStart</span>;
  
  <span style="color:#75715e">// 範囲選択をしていない場合
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">posStart</span> <span style="color:#f92672">===</span> <span style="color:#a6e22e">posEnd</span>) {
    <span style="color:#75715e">// 空白をすべて削除
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">$</span>(<span style="color:#e6db74">&#34;#input&#34;</span>).<span style="color:#a6e22e">val</span>(<span style="color:#a6e22e">inputStr</span>.<span style="color:#a6e22e">replace</span>(<span style="color:#e6db74">/[ 　\t]/g</span>, <span style="color:#e6db74">&#34;&#34;</span>));
    <span style="color:#75715e">// キャレットの位置から前にある空白の数だけキャレットの位置を前に移動する
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">moveCount</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">inputStr</span>.<span style="color:#a6e22e">substring</span>(<span style="color:#ae81ff">0</span>, <span style="color:#a6e22e">posStart</span>).<span style="color:#a6e22e">match</span>(<span style="color:#e6db74">/[ 　\t]/g</span>) <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span>) <span style="color:#f92672">?</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">:</span> <span style="color:#a6e22e">inputStr</span>.<span style="color:#a6e22e">substring</span>(<span style="color:#ae81ff">0</span>, <span style="color:#a6e22e">posStart</span>).<span style="color:#a6e22e">match</span>(<span style="color:#e6db74">/[ 　\t]/g</span>).<span style="color:#a6e22e">length</span>;
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">pos</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">posStart</span> <span style="color:#f92672">-</span> <span style="color:#a6e22e">moveCount</span>;
    <span style="color:#a6e22e">$</span>(<span style="color:#e6db74">&#34;#input&#34;</span>).<span style="color:#a6e22e">get</span>(<span style="color:#ae81ff">0</span>).<span style="color:#a6e22e">setSelectionRange</span>(<span style="color:#a6e22e">pos</span>, <span style="color:#a6e22e">pos</span>);
  }
  <span style="color:#75715e">// 範囲選択をしている場合
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">else</span> {
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">selStr</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">inputStr</span>.<span style="color:#a6e22e">substring</span>(<span style="color:#a6e22e">posStart</span>, <span style="color:#a6e22e">posEnd</span>);
    <span style="color:#75715e">// 空白をすべて削除
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">$</span>(<span style="color:#e6db74">&#34;#input&#34;</span>).<span style="color:#a6e22e">val</span>(<span style="color:#a6e22e">inputStr</span>.<span style="color:#a6e22e">substring</span>(<span style="color:#ae81ff">0</span>, <span style="color:#a6e22e">posStart</span>) <span style="color:#f92672">+</span> <span style="color:#a6e22e">selStr</span>.<span style="color:#a6e22e">replace</span>(<span style="color:#e6db74">/[ 　\t]/g</span>, <span style="color:#e6db74">&#34;&#34;</span>) <span style="color:#f92672">+</span> <span style="color:#a6e22e">inputStr</span>.<span style="color:#a6e22e">substring</span>(<span style="color:#a6e22e">posEnd</span>, <span style="color:#a6e22e">inputStr</span>.<span style="color:#a6e22e">length</span>));
    <span style="color:#a6e22e">$</span>(<span style="color:#e6db74">&#34;#input&#34;</span>).<span style="color:#a6e22e">get</span>(<span style="color:#ae81ff">0</span>).<span style="color:#a6e22e">setSelectionRange</span>(<span style="color:#a6e22e">posStart</span>, <span style="color:#a6e22e">posStart</span>);
  }
}



<span style="color:#75715e">// 空白改行削除
</span><span style="color:#75715e"></span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">spaceNewlineDelete</span>() {
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">posStart</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">$</span>(<span style="color:#e6db74">&#34;#input&#34;</span>).<span style="color:#a6e22e">get</span>(<span style="color:#ae81ff">0</span>).<span style="color:#a6e22e">selectionStart</span>;
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">posEnd</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">$</span>(<span style="color:#e6db74">&#34;#input&#34;</span>).<span style="color:#a6e22e">get</span>(<span style="color:#ae81ff">0</span>).<span style="color:#a6e22e">selectionEnd</span>;
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">inputStr</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">$</span>(<span style="color:#e6db74">&#34;#input&#34;</span>).<span style="color:#a6e22e">val</span>();
  
  <span style="color:#75715e">// 範囲選択をしていない場合
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">posStart</span> <span style="color:#f92672">===</span> <span style="color:#a6e22e">posEnd</span>) {
  <span style="color:#75715e">// 空白改行をすべて削除
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">$</span>(<span style="color:#e6db74">&#34;#result&#34;</span>).<span style="color:#a6e22e">val</span>(<span style="color:#a6e22e">inputStr</span>.<span style="color:#a6e22e">replace</span>(<span style="color:#e6db74">/[ 　\n\r\t]/g</span>, <span style="color:#e6db74">&#34;&#34;</span>));
  }
  <span style="color:#75715e">// 範囲選択をしている場合
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">else</span> {
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">selStr</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">inputStr</span>.<span style="color:#a6e22e">substring</span>(<span style="color:#a6e22e">posStart</span>, <span style="color:#a6e22e">posEnd</span>);
    <span style="color:#75715e">// 改行をすべて削除
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">$</span>(<span style="color:#e6db74">&#34;#result&#34;</span>).<span style="color:#a6e22e">val</span>(<span style="color:#a6e22e">selStr</span>.<span style="color:#a6e22e">replace</span>(<span style="color:#e6db74">/[ 　\n\r\t]/g</span>, <span style="color:#e6db74">&#34;&#34;</span>));
  }
  
  <span style="color:#a6e22e">$</span>(<span style="color:#e6db74">&#34;#result&#34;</span>).<span style="color:#a6e22e">focus</span>();
}
</code></pre></td></tr></table>
</div>
</div>
<p>範囲選択をしていない場合は非常にシンプルなのですが、範囲を選択している時は選択範囲にのみ処理を実行させるようにすると処理が複雑になります。<br />
範囲選択をしている時は、選択範囲の始点と終点を取得し、それを基に処理を行います。</p>

<h2 id="tabの処理">Tabの処理</h2>

<p>ここが1番大変でした。<br />
ここに1番時間がかかりました。<br />
とりあえずソースはこんな感じです。</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">55
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">56
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">57
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">58
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">59
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">60
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">61
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">62
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">63
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">64
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">65
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">66
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">67
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">68
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">69
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">70
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">71
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">72
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">73
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">74
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">75
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">76
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">77
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">78
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">79
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">80
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">81
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">82
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">83
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">84
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">85
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#75715e">// タブを入力
</span><span style="color:#75715e"></span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">insertTab</span>() {
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">posStart</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">$</span>(<span style="color:#e6db74">&#34;#input&#34;</span>).<span style="color:#a6e22e">get</span>(<span style="color:#ae81ff">0</span>).<span style="color:#a6e22e">selectionStart</span>;
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">posEnd</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">$</span>(<span style="color:#e6db74">&#34;#input&#34;</span>).<span style="color:#a6e22e">get</span>(<span style="color:#ae81ff">0</span>).<span style="color:#a6e22e">selectionEnd</span>;
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">inputStr</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">$</span>(<span style="color:#e6db74">&#34;#input&#34;</span>).<span style="color:#a6e22e">val</span>();
  
  <span style="color:#75715e">// 範囲選択をしていない場合
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">posStart</span> <span style="color:#f92672">===</span> <span style="color:#a6e22e">posEnd</span>) {
    <span style="color:#75715e">// カーソルの位置にタブを追加
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">$</span>(<span style="color:#e6db74">&#34;#input&#34;</span>).<span style="color:#a6e22e">val</span>(<span style="color:#a6e22e">inputStr</span>.<span style="color:#a6e22e">substring</span>(<span style="color:#ae81ff">0</span>,<span style="color:#a6e22e">posStart</span>) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;\t&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">inputStr</span>.<span style="color:#a6e22e">substring</span>(<span style="color:#a6e22e">posStart</span>, <span style="color:#a6e22e">inputStr</span>.<span style="color:#a6e22e">length</span>));
    <span style="color:#75715e">// カーソルの位置をタブの後ろに移動させる
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">$</span>(<span style="color:#e6db74">&#34;#input&#34;</span>).<span style="color:#a6e22e">get</span>(<span style="color:#ae81ff">0</span>).<span style="color:#a6e22e">setSelectionRange</span>(<span style="color:#a6e22e">posStart</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>, <span style="color:#a6e22e">posStart</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>);
  }
  <span style="color:#75715e">// 範囲選択をしている場合
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">else</span> {
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">beforeSelStr</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">inputStr</span>.<span style="color:#a6e22e">substring</span>(<span style="color:#ae81ff">0</span>, <span style="color:#a6e22e">posStart</span>);
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">selStr</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">inputStr</span>.<span style="color:#a6e22e">substring</span>(<span style="color:#a6e22e">posStart</span>, <span style="color:#a6e22e">posEnd</span>);
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">afterSelStr</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">inputStr</span>.<span style="color:#a6e22e">substring</span>(<span style="color:#a6e22e">posEnd</span>, <span style="color:#a6e22e">inputStr</span>.<span style="color:#a6e22e">length</span>);
    
    <span style="color:#75715e">// 選択範囲始点の行頭にタブを追加
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">beforeSelStrSplit</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">beforeSelStr</span>.<span style="color:#a6e22e">split</span>(<span style="color:#e6db74">/\n|\r|\r\n/g</span>);
    <span style="color:#a6e22e">beforeSelStrSplit</span>[<span style="color:#a6e22e">beforeSelStrSplit</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;\t&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">beforeSelStrSplit</span>[<span style="color:#a6e22e">beforeSelStrSplit</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>];
    <span style="color:#75715e">// 選択範囲の行頭にタブを追加
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">selStr</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">selStr</span>.<span style="color:#a6e22e">replace</span>(<span style="color:#e6db74">/[\n\r]/g</span>, <span style="color:#e6db74">&#34;\n\t&#34;</span>);
    <span style="color:#75715e">// 分割した文字列を結合
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">$</span>(<span style="color:#e6db74">&#34;#input&#34;</span>).<span style="color:#a6e22e">val</span>(<span style="color:#a6e22e">beforeSelStrSplit</span>.<span style="color:#a6e22e">join</span>(<span style="color:#e6db74">&#34;\n&#34;</span>) <span style="color:#f92672">+</span> <span style="color:#a6e22e">selStr</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">afterSelStr</span>);
    <span style="color:#75715e">// カーソルの選択範囲を維持する
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">$</span>(<span style="color:#e6db74">&#34;#input&#34;</span>).<span style="color:#a6e22e">get</span>(<span style="color:#ae81ff">0</span>).<span style="color:#a6e22e">setSelectionRange</span>(<span style="color:#a6e22e">posStart</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>, <span style="color:#a6e22e">posEnd</span> <span style="color:#f92672">+</span> ((<span style="color:#a6e22e">selStr</span>.<span style="color:#a6e22e">match</span>(<span style="color:#e6db74">/[\n\r]/g</span>) <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span>) <span style="color:#f92672">?</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">:</span> <span style="color:#a6e22e">selStr</span>.<span style="color:#a6e22e">match</span>(<span style="color:#e6db74">/[\n\r]/g</span>).<span style="color:#a6e22e">length</span>) <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>);
  }
}



<span style="color:#75715e">// 行頭のタブを削除
</span><span style="color:#75715e"></span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">deleteTab</span>() {
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">posStart</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">$</span>(<span style="color:#e6db74">&#34;#input&#34;</span>).<span style="color:#a6e22e">get</span>(<span style="color:#ae81ff">0</span>).<span style="color:#a6e22e">selectionStart</span>;
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">posEnd</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">$</span>(<span style="color:#e6db74">&#34;#input&#34;</span>).<span style="color:#a6e22e">get</span>(<span style="color:#ae81ff">0</span>).<span style="color:#a6e22e">selectionEnd</span>;
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">inputStr</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">$</span>(<span style="color:#e6db74">&#34;#input&#34;</span>).<span style="color:#a6e22e">val</span>();
  
  <span style="color:#75715e">// 範囲選択をしていない場合
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">posStart</span> <span style="color:#f92672">===</span> <span style="color:#a6e22e">posEnd</span>) {
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">beforeSelStr</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">inputStr</span>.<span style="color:#a6e22e">substring</span>(<span style="color:#ae81ff">0</span>, <span style="color:#a6e22e">posStart</span>);
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">afterSelStr</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">inputStr</span>.<span style="color:#a6e22e">substring</span>(<span style="color:#a6e22e">posStart</span>, <span style="color:#a6e22e">inputStr</span>.<span style="color:#a6e22e">length</span>);
    
    <span style="color:#75715e">// キャレットの行を取得
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">beforeSelStrSplit</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">beforeSelStr</span>.<span style="color:#a6e22e">split</span>(<span style="color:#e6db74">/\n|\r|\r\n/g</span>);
    <span style="color:#a6e22e">afterSelStrSplit</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">afterSelStr</span>.<span style="color:#a6e22e">split</span>(<span style="color:#e6db74">/\n|\r|\r\n/g</span>);
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">beforeSelLineStr</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">beforeSelStrSplit</span>[<span style="color:#a6e22e">beforeSelStrSplit</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>];
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">targetStr</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">beforeSelLineStr</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">afterSelStrSplit</span>[<span style="color:#ae81ff">0</span>];
    <span style="color:#a6e22e">afterSelStrSplit</span>[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>;
    <span style="color:#75715e">// 行頭のタブを削除
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">beforeSelStrSplit</span>[<span style="color:#a6e22e">beforeSelStrSplit</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">targetStr</span>.<span style="color:#a6e22e">replace</span>(<span style="color:#e6db74">/^\t/</span>, <span style="color:#e6db74">&#34;&#34;</span>);
    <span style="color:#75715e">// 分割した文字列を結合
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">$</span>(<span style="color:#e6db74">&#34;#input&#34;</span>).<span style="color:#a6e22e">val</span>(<span style="color:#a6e22e">beforeSelStrSplit</span>.<span style="color:#a6e22e">join</span>(<span style="color:#e6db74">&#34;\n&#34;</span>) <span style="color:#f92672">+</span> <span style="color:#a6e22e">afterSelStrSplit</span>.<span style="color:#a6e22e">join</span>(<span style="color:#e6db74">&#34;\n&#34;</span>));
    <span style="color:#75715e">// カーソルの位置を維持する
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">moveCount</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">beforeSelLineStr</span>.<span style="color:#a6e22e">match</span>(<span style="color:#e6db74">/^\t/</span>) <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span>) <span style="color:#f92672">?</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">:</span> <span style="color:#ae81ff">1</span>;
    <span style="color:#a6e22e">$</span>(<span style="color:#e6db74">&#34;#input&#34;</span>).<span style="color:#a6e22e">get</span>(<span style="color:#ae81ff">0</span>).<span style="color:#a6e22e">setSelectionRange</span>(<span style="color:#a6e22e">posStart</span> <span style="color:#f92672">-</span> <span style="color:#a6e22e">moveCount</span>, <span style="color:#a6e22e">posStart</span> <span style="color:#f92672">-</span> <span style="color:#a6e22e">moveCount</span>);
  }
  <span style="color:#75715e">// 範囲選択をしている場合
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">else</span> {
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">beforeSelStr</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">inputStr</span>.<span style="color:#a6e22e">substring</span>(<span style="color:#ae81ff">0</span>, <span style="color:#a6e22e">posStart</span>);
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">selStr</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">inputStr</span>.<span style="color:#a6e22e">substring</span>(<span style="color:#a6e22e">posStart</span>, <span style="color:#a6e22e">posEnd</span>);
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">afterSelStr</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">inputStr</span>.<span style="color:#a6e22e">substring</span>(<span style="color:#a6e22e">posEnd</span>, <span style="color:#a6e22e">inputStr</span>.<span style="color:#a6e22e">length</span>);
    
    <span style="color:#75715e">// 対象となる行を取得
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">beforeSelStrSplit</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">beforeSelStr</span>.<span style="color:#a6e22e">split</span>(<span style="color:#e6db74">/\n|\r|\r\n/g</span>);
    <span style="color:#a6e22e">selStrSplit</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">selStr</span>.<span style="color:#a6e22e">split</span>(<span style="color:#e6db74">/\n|\r|\r\n/g</span>);
    <span style="color:#a6e22e">afterSelStrSplit</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">afterSelStr</span>.<span style="color:#a6e22e">split</span>(<span style="color:#e6db74">/\n|\r|\r\n/g</span>);
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">beforeSelLineStr</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">beforeSelStrSplit</span>[<span style="color:#a6e22e">beforeSelStrSplit</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>];
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">afterSelLineStr</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">selStrSplit</span>[<span style="color:#a6e22e">selStrSplit</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>];
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">targetStr</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">beforeSelLineStr</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">selStr</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">afterSelStrSplit</span>[<span style="color:#ae81ff">0</span>];
    <span style="color:#a6e22e">beforeSelStrSplit</span>[<span style="color:#a6e22e">beforeSelStrSplit</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>;
    <span style="color:#a6e22e">afterSelStrSplit</span>[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>;
    <span style="color:#75715e">// 行頭のタブを削除
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">selStr</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">targetStr</span>.<span style="color:#a6e22e">replace</span>(<span style="color:#e6db74">/^\t/</span>, <span style="color:#e6db74">&#34;&#34;</span>).<span style="color:#a6e22e">replace</span>(<span style="color:#e6db74">/\n\t|\r\t|\r\n\t/g</span>, <span style="color:#e6db74">&#34;\n&#34;</span>);
    <span style="color:#75715e">// 分割した文字列を結合
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">$</span>(<span style="color:#e6db74">&#34;#input&#34;</span>).<span style="color:#a6e22e">val</span>(<span style="color:#a6e22e">beforeSelStrSplit</span>.<span style="color:#a6e22e">join</span>(<span style="color:#e6db74">&#34;\n&#34;</span>) <span style="color:#f92672">+</span> <span style="color:#a6e22e">selStr</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">afterSelStrSplit</span>.<span style="color:#a6e22e">join</span>(<span style="color:#e6db74">&#34;\n&#34;</span>));
    <span style="color:#75715e">// カーソルの位置を維持する
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">moveCountStart</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">beforeSelLineStr</span>.<span style="color:#a6e22e">match</span>(<span style="color:#e6db74">/^\t/</span>) <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span>) <span style="color:#f92672">?</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">:</span> <span style="color:#ae81ff">1</span>;
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">moveCountEnd</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">afterSelLineStr</span>.<span style="color:#a6e22e">match</span>(<span style="color:#e6db74">/^\t/</span>) <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span>) <span style="color:#f92672">?</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">:</span> <span style="color:#ae81ff">1</span>;
    <span style="color:#a6e22e">moveCountEnd</span> <span style="color:#f92672">+=</span> (<span style="color:#a6e22e">targetStr</span>.<span style="color:#a6e22e">match</span>(<span style="color:#e6db74">/\n\t|\r\t|\r\n\t/g</span>) <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span>) <span style="color:#f92672">?</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">:</span> <span style="color:#a6e22e">targetStr</span>.<span style="color:#a6e22e">match</span>(<span style="color:#e6db74">/\n\t|\r\t|\r\n\t/g</span>).<span style="color:#a6e22e">length</span>;
    <span style="color:#a6e22e">$</span>(<span style="color:#e6db74">&#34;#input&#34;</span>).<span style="color:#a6e22e">get</span>(<span style="color:#ae81ff">0</span>).<span style="color:#a6e22e">setSelectionRange</span>(<span style="color:#a6e22e">posStart</span> <span style="color:#f92672">-</span> <span style="color:#a6e22e">moveCountStart</span>, <span style="color:#a6e22e">posEnd</span> <span style="color:#f92672">-</span> <span style="color:#a6e22e">moveCountEnd</span>);
  }
}
</code></pre></td></tr></table>
</div>
</div>
<p>はい、ご覧のとおり複雑なことになってます。<br />
なぜかといいますと、textareaからは行頭というものを取得できないためです。<br />
改行記号を含んだ文字列として扱われます。<br />
なので、Shift + Tabをした場合や範囲選択をしている場合は、行頭を判別する処理が必要になります。<br />
また、Tab文字を入れたり消したりしますので、キャレットの位置がずれてしまいます。<br />
なので、変動した文字数を数えて、それに合わせてキャレットを移動させてあげています。<br />
ここらへんの処理がcontenteditableを使うと簡潔に書けそうな感じでした。（ブラウザは制限されるかも知れませんが。）</p>

<h2 id="まとめ">まとめ</h2>

<p>現時点でこのWebアプリはver.4です。<br />
ver.3では、Sfhit + Tab以外のキーボードからひと通りの処理に対応、空白文字可視化、などを行って制作時間は7時間くらい。<br />
ver.4では、Shift + Tab対応、範囲選択の処理に対応、デザイン変更、などを行って制作時間は12時間くらい。<br />
補助機能の実装に1番時間がかかってしまった。<br />
今までの合計製作時間は26時間くらいですね。<br />
非常に楽しく実装できて、とても勉強になって、一時期非常に役に立ったので、とても有意義でした。</p>

<h2 id="参考にさせていただいたサイト">参考にさせていただいたサイト</h2>

<ul>
<li><a href="http://qiita.com/yuku_t/items/516ec6fe59b77b93edc5" title="JavaScript - Facebookみたいにtextareaの一部を強調する - Qiita [キータ]">JavaScript - Facebookみたいにtextareaの一部を強調する - Qiita [キータ]</a></li>
<li><a href="http://www.backlog.jp/blog/2013/06/facebook-like-textarea.html" title="Facebookライクにテキストエリアを強調する方法 | Backlogブログ">Facebookライクにテキストエリアを強調する方法 | Backlogブログ</a></li>
<li><a href="http://ginpen.com/2012/12/24/fix-window-height/" title="CSSだけでウィンドウぴったりに表示する編集画面を作る。（CSS おれおれ Advent Calendar 2012 – 23日目） | Ginpen.com">CSSだけでウィンドウぴったりに表示する編集画面を作る。（CSS おれおれ Advent Calendar 2012 – 23日目） | Ginpen.com</a></li>
<li><a href="http://ginpen.com/2011/07/01/height-100-parcent/" title="CSSでheight:100%を使う方法について。 | Ginpen.com">CSSでheight:100%を使う方法について。 | Ginpen.com</a></li>
<li><a href="http://d.hatena.ne.jp/hokaccha/20111028/1319814792" title="textareaでタブを入力できるようにする - hokaccha.hamalog v2">textareaでタブを入力できるようにする - hokaccha.hamalog v2</a></li>
</ul>

    </div>
</article>
<footer>
    <div class="writer">
        <div>菅原 浩</div>
    </div>
    <div class="about">
        <div>プロフィール</div>
        <div><a href="https://github.com/5000164/profile">詳細はこちら</a></div>
    </div>
    <div class="year">
        <div>年別記事一覧</div>
        <ul>
            
            <li>
    <a href="https://blog.5000164.jp/2012/">
        <div>2012</div>
    </a>
</li>

            
            <li>
    <a href="https://blog.5000164.jp/2013/">
        <div>2013</div>
    </a>
</li>

            
            <li>
    <a href="https://blog.5000164.jp/2014/">
        <div>2014</div>
    </a>
</li>

            
            <li>
    <a href="https://blog.5000164.jp/2015/">
        <div>2015</div>
    </a>
</li>

            
            <li>
    <a href="https://blog.5000164.jp/2016/">
        <div>2016</div>
    </a>
</li>

            
            <li>
    <a href="https://blog.5000164.jp/2017/">
        <div>2017</div>
    </a>
</li>

            
            <li>
    <a href="https://blog.5000164.jp/2018/">
        <div>2018</div>
    </a>
</li>

            
        </ul>
    </div>
</footer>
</body>
</html>

