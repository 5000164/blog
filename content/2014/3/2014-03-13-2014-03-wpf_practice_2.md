+++
title = "WPFで方向キーを入力した方向へ四角形を動かす"
date: 2014-03-13T04:21:42+00:00
permalink: /2014-03-wpf_practice_2/
image: /wp-content/uploads/2014/03/20140312_practice2_eye.png
+++
<img src="http://5000164.jp/wp-content/uploads/2014/03/20140312_practice2-300x200.png" alt="20140312_practice2" width="300" height="200" class="aligncenter size-medium wp-image-1150" srcset="http://5000164.jp/wp-content/uploads/2014/03/20140312_practice2-300x200.png 300w, http://5000164.jp/wp-content/uploads/2014/03/20140312_practice2.png 525w" sizes="(max-width: 300px) 100vw, 300px" />

# 実際に作ったものはこんな感じです

<img src="http://5000164.jp/wp-content/uploads/2014/03/20140312_practice2.png" alt="20140312_practice2" width="525" height="350" class="aligncenter size-full wp-image-1150" srcset="http://5000164.jp/wp-content/uploads/2014/03/20140312_practice2.png 525w, http://5000164.jp/wp-content/uploads/2014/03/20140312_practice2-300x200.png 300w" sizes="(max-width: 525px) 100vw, 525px" />

方向キーの入力した方向へで赤い点が動きます。
  
ソースコードはこちら。
  
[5000164/wpf-practice-2](https://github.com/5000164/wpf-practice-2)

# 画面に動かすものを表示する

とりあえずなんでもよかったので、Rectangleタグで四角形を表示します。
  
そして、位置を指定するためにCanvasタグで囲みます。

<pre class="brush: xml; title: ; notranslate" title="">&lt;Canvas&gt;
            &lt;Rectangle Name="pointer" Width="10" Height="10" Fill="Red" Canvas.Left="0" Canvas.Top="0" /&gt;
        &lt;/Canvas&gt;
</pre>

これでXAML側はほぼ完成。
  
あとは動かすだけ。

# キーボードの入力を取得します

WindowにPreviewKeyDownをつけます。
  
これでキーが押されたらイベントが発生します。

[WPFサンプル:KeyDownイベントとKeybord.Modifiersプロパティ:Gushwell&#8217;s C# Dev Notes](http://gushwell.ldblog.jp/archives/52318833.html)

# C#側で座標を取得するために

まずは四角にNameをつけます。
  
これでC#側で変数として扱えます。

[XAML とプログラムコード（WPF） (.NET Framework)](http://ufcpp.net/study/dotnet/wpf_xamlcode.html)

# 四角の現在位置を取得する

C#側で四角につけた名前から座標を取得します。

<pre class="brush: csharp; title: ; notranslate" title="">// 現在地を取得
            Double leftPosition = Canvas.GetLeft(this.pointer);
            Double topPosition = Canvas.GetTop(this.pointer);
</pre>

[Canvas.GetLeft メソッド (System.Windows.Controls)](http://msdn.microsoft.com/ja-jp/library/system.windows.controls.canvas.getleft(v=vs.110).aspx)

# 入力されたキーの内容を判断する

次は、方向キーが入力された方向へ動くために、入力されたキーを判断します。

<pre class="brush: csharp; title: ; notranslate" title="">// 入力された方向キーの方向へ移動
            if (e.Key == Key.Up)
                // 上
            else if (e.Key == Key.Down)
                // 下
            else if (e.Key == Key.Left)
                // 左
            else if (e.Key == Key.Right)
                // 右
</pre>

[Key 列挙体 (System.Windows.Input)](http://msdn.microsoft.com/ja-jp/library/system.windows.input.key(v=vs.110).aspx)

# 入力された方向へ移動する

入力された方向がわかったら、その方向へ座標を移動してthis.pointerにセットします。

<pre class="brush: csharp; title: ; notranslate" title="">// 入力された方向キーの方向へ移動
            if (e.Key == Key.Up)
                Canvas.SetTop(this.pointer, topPosition - 10);
            else if (e.Key == Key.Down)
                Canvas.SetTop(this.pointer, topPosition + 10);
            else if (e.Key == Key.Left)
                Canvas.SetLeft(this.pointer, leftPosition - 10);
            else if (e.Key == Key.Right)
                Canvas.SetLeft(this.pointer, leftPosition + 10);
</pre>

[Canvas.SetLeft メソッド (System.Windows.Controls)](http://msdn.microsoft.com/ja-jp/library/system.windows.controls.canvas.setleft(v=vs.110).aspx)

# 完成

これで、キーボードの方向キーを入力した方向へ移動することができました。
  
ただ、ゲームのようなものを作ろうと思っていたのですが、これだと実装が大変そうです。
  
他の方法も調べてみようと思います。